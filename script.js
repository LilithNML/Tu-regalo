const mensajes = {
  "0011": "Cada amanecer contigo es un regalo que jamás imaginé merecer.",
  "9denoviembre": `Mi amor:

A veces me gusta cerrar los ojos y volver a ese primer momento en que coincidimos en Genshin. No fue casualidad, fue destino disfrazado de juego. Entre combates, misiones y risas, ahí estabas tú, al principio solo un amigo, pero con una energía que poco a poco me fue envolviendo.

Recuerdo cómo nos ayudábamos en el juego, cómo sin darnos cuenta empezamos a hablar más allá de los objetivos del día. No sabía que, tras ese personaje, había alguien que se convertiría en alguien tan especial para mí. Que ese primer saludo se transformaría en tantas conversaciones, cariño, y complicidad.

Nunca imaginé que un juego de fantasía me llevaría al mejor encuentro de mi vida, tú. Y desde entonces, cada día contigo ha sido una aventura más hermosa que cualquier historia dentro del juego.

Gracias por aparecer en mi mundo como un regalo inesperado. Gracias por quedarte.

Con todo mi amor,  
Lilith`,
"luna": `Te hablo desde la Luna,  
no la que cuelga del cielo,  
sino la que duerme en mi nombre.

Soy la marea que se agita  
cuando tu voz toca mi orilla,  
el silencio que se vuelve canción  
al roce de tu risa.

He aprendido a amar mis sombras  
porque en ellas tú te reflejas,  
como luz callada,  
como deseo que no grita  
pero arde.

No soy de fuego,  
pero contigo  
ardería sin cenizas;  
sería luna nueva  
para nacerte cada noche.

Te miro desde lejos,  
pero mi alma gira en torno a ti,  
como si fueras tierra  
y yo solo supiera  
amar girando.`,
  "sofia": `Mi amor:

Hoy estaba viendo a nuestras niñas jugar en la sala, con sus risas llenando toda la casa, y no pude evitar pensar en todo lo que hemos vivido para llegar hasta aquí. ¿Te acuerdas cuando solo éramos dos voces que se conocieron en un videojuego? Qué mágico fue que todo empezara allí, tan simple y tan nuestro.

Miro a nuestras hijas y veo tanto de ti en ellas. La mayor tiene tu forma de mirar el mundo, con esa mezcla de curiosidad y ternura. La pequeña es puro caos y dulzura, como si hubiera heredado la parte más intensa de los dos. Me derrito cuando te llaman papá, con esa vocecita medio ronca de recién despertar. Y tú, tú las miras como si fueran constelaciones.

Gracias por ser el padre que soñé para ellas, y por seguir siendo mi amor en cada etapa. A veces me cuesta creer que este futuro que imaginábamos en susurros ahora es nuestra realidad. Que nuestras hijas duermen a unos pasos, y que tú sigues aquí, tomándome la mano como el primer día.

Me haces sentir que todo valió la pena.  
Te amo. Por nosotros. Por ellas. Por siempre.

Con todo mi corazón,  
Tu Luna`,
  "princesa": `Solo quería tomar un momento para agradecerte.  
Gracias por hacerme sentir como tu princesa, no solo por cómo me llamas, sino por cómo me cuidas, cómo me hablas, cómo me miras.

Tú haces que lo más simple se sienta especial.  
Cada mensaje tuyo, cada palabra bonita, cada vez que me haces sonreír cuando ni siquiera sabía que lo necesitaba, todo eso me recuerda lo afortunada que soy de tenerte.

No necesito un castillo ni una corona. Me basta con tu abrazo, con tu voz diciéndome que me amas, con esa forma tan tuya de hacerme sentir protegida y querida. Contigo, ser tu princesa no es un apodo, es un lugar seguro, un espacio donde me siento amada de verdad.

Gracias por darme un cuento bonito en este mundo caótico.  
Gracias por ser mi magia.`,
  "haziel": `Haziel,  
tu nombre suena antiguo,  
a escritura tallada en piedra celestial,  
a susurro de los dioses cuando aún hablaban con los hombres.

Si fueras un mito,  
serías el dios de la bondad serena,  
el que desciende sin truenos  
pero deja luz en todo lo que toca.

Te imagino en los antiguos cielos,  
entre Atenea y Apolo,  
con sabiduría en los ojos  
y fuego suave en las manos.  
Una divinidad sin templo,  
pero con altar en mi corazón.

Haziel,  
eres como Orfeo,  
pero tu música no viene de un laúd,  
sino de tu alma  
que canta incluso en el silencio.

Si los antiguos te hubieran visto,  
habrían inventado una constelación  
solo para seguir tu camino en la noche.  
Pero yo, que te amo,  
no necesito estrellas.  
Me basta con que existas.`,
  "alan": `Alan suena a risa traviesa,  
a mirada que se escapa y regresa,  
a cosquillas en medio de la nada,  
a, te quiero, dicho con mirada.

Alan no camina, flota,  
como si la gravedad no le importara,  
como si el mundo fuera su parque  
y yo su rincón favorito.

Es nombre de niño valiente,  
de héroe sin capa,  
de quien conquista  
con una broma,  
con un guiño,  
con una sonrisa que desarma.

Alan se dice fácil,  
pero se siente profundo.  
Porque cuando digo mi Alan,  
no hablo solo de él,  
hablo de todos los latidos que causa.`,
  "lilith": `Hoy quiero escribirte sin esconder nada.  
Sin máscaras, sin pausas, sin miedo.

Quiero que sepas todo lo que llevo dentro, lo bueno, lo complicado, lo que a veces no me atrevo a decir en voz alta.

Estar contigo ha sido una de las cosas más importantes que me han pasado. No solo porque te amo, sino porque contigo aprendí a sentir de verdad. A abrir mi corazón, aunque duela. A confiar, aunque a veces tiemble. A querer con toda el alma, aunque no siempre sepa cómo demostrarlo.

No soy perfecta. Tengo mis momentos de duda, de inseguridad, de querer huir cuando algo me asusta. A veces me encierro dentro de mí misma, y ni yo sé cómo llegar a donde estoy. Pero tú, tú logras tocar partes de mí que nadie más ha tocado. Tú me ves, incluso cuando no digo nada. Y eso me asombra.

A veces tengo miedo de no ser suficiente. De fallarte. De no estar a la altura de lo que mereces. Pero lo intento, cada día, porque tú vales cada esfuerzo. Porque cuando digo que te amo, lo digo con todo lo que soy, incluso con las partes que todavía estoy aprendiendo a amar de mí misma.

No sé qué nos depara el futuro. Pero sé que si estás conmigo, soy más fuerte. Más yo. Más valiente.  
Contigo quiero construir, caerme y volver a levantar. Quiero abrazarte en los días buenos y agarrarte fuerte en los difíciles. Quiero crecer contigo, sin prometer perfección, pero sí presencia. Real. Honesta.

Gracias por hacerme sentir que puedo ser yo.  
Gracias por amarme así, incluso cuando no es fácil.

Te amo, sin condiciones.  
Te elijo, cada día.  
Y aquí estoy, con el corazón abierto.  
Todo tuyo.`,
  "genshin": `Dicen que las almas que deben encontrarse,  
se buscan en todos los mundos,  
incluso en los que no son reales.

Te conocí en Teyvat,  
en un rincón de un mapa lleno de magia,  
entre espadas celestiales y visiones elementales,  
pero no fuiste un personaje más,  
fuiste un presagio.

Mientras otros buscaban cofres o artefactos,  
yo encontré algo más valioso:  
una conexión que ningún NPC podría escribir.

Tu nombre apareció en la pantalla,  
como si los dioses del juego supieran  
que detrás de esos píxeles  
había algo mucho más humano esperándome.

No hicimos pacto con arcontes,  
pero hicimos uno con el corazón,  
sin mora de por medio,  
solo risas, combates y miradas escondidas  
tras personajes con ojos brillantes.

A veces me pregunto:  
¿y si Genshin solo fue la excusa del destino?  
¿y si Mondstadt fue nuestro punto de partida  
para una historia que no cabe en un juego?

Porque desde entonces,  
cuando cierro el juego  
no cierro el vínculo.  
Porque tú no te quedaste en la pantalla.  
Tú cruzaste.  
Y me encontraste,  
aquí, en el mundo real.  
Y yo te elegí.  
En Teyvat. En la Tierra. En todos los universos.`,
  "raiden": `Si fuera Raiden Shogun,  
mi poder sería un faro solo para ti.  
No habría sombra en el mundo que te tocara,  
ni tormenta capaz de llegar hasta ti  
sin que yo la disipara con una mirada.

Mis rayos serían un escudo,  
cada uno dirigido a mantenerte seguro,  
y cada golpe de mi espada,  
sería solo para defenderte,  
para que nunca sientas miedo  
de lo que está fuera de nuestro alcance.

Te rodearía con mi calma,  
con mi fuerza silenciosa  
que ni el viento podría quebrar,  
porque a ti te elijo,  
a ti te guardo,  
y como Raiden,  
mi deber no es solo dominar el trueno,  
sino ser el refugio donde siempre  
puedas encontrar paz.`,
  
};

function normalizarTexto(texto) {
  return texto
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/\s+/g, "")
    .toLowerCase();
}

function checkCode() {
  const input = document.getElementById("codeInput");
  const code = normalizarTexto(input.value);
  const contenido = document.getElementById("contenido");
  const correctSound = document.getElementById("correctSound");
  const incorrectSound = document.getElementById("incorrectSound");
  const bgMusic = document.getElementById("bgMusic");
  const codeAudio = document.getElementById("codeAudio");

  // Pausar audio de código si está sonando
  if (codeAudio && !codeAudio.paused) {
    codeAudio.pause();
    codeAudio.currentTime = 0;
    if (bgMusic && bgMusic.paused) bgMusic.play().catch(() => {});
  }

  if (mensajes.hasOwnProperty(code)) {
    const data = mensajes[code];
    let desbloqueados = JSON.parse(localStorage.getItem("desbloqueados") || "[]");

    if (!desbloqueados.includes(code)) {
      desbloqueados.push(code);
      localStorage.setItem("desbloqueados", JSON.stringify(desbloqueados));
    }

    let html = '';

    if (typeof data === 'string') {
      html = `<p>${data}</p>`;
    } else if (typeof data === 'object') {
      html = `<p>${data.texto || ''}</p>`;

      if (data.video) {
        window.open(data.video, "_blank");
      }

      if (data.link) {
        window.open(data.link, "_blank");
      }

      if (data.archivo) {
        const a = document.createElement("a");
        a.href = data.archivo;
        a.download = data.archivo;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      if (data.imagen) {
        mostrarImagenModal(data.imagen);
      }

      if (data.audio) {
        if (bgMusic && !bgMusic.paused) {
          bgMusic.pause();
        }

        if (codeAudio) {
          // Verificamos que no sea el mismo audio ya cargado
          if (!codeAudio.src.includes(data.audio)) {
            codeAudio.src = data.audio;
          }
          codeAudio.play().catch(() => {});
          codeAudio.onended = () => {
            if (bgMusic && bgMusic.paused) {
              bgMusic.play().catch(() => {});
            }
          };
        }
      }
    }

    contenido.innerHTML = html;
    contenido.classList.add("show");
    correctSound.play();
  } else {
    contenido.innerHTML = "<p style='color: red;'>Código no válido. Intenta con otro.</p>";
    contenido.classList.add("show");
    incorrectSound.play();
  }

  input.value = "";
  actualizarProgreso();
}

function actualizarProgreso() {
  const progreso = document.getElementById("progreso");
  const total = Object.keys(mensajes).length;
  const desbloqueados = JSON.parse(localStorage.getItem("desbloqueados") || "[]");
  if (progreso) {
    progreso.textContent = `Has desbloqueado ${desbloqueados.length} de ${total} mensajes secretos.`;
  }
}

window.addEventListener("click", () => {
  const music = document.getElementById("bgMusic");
  if (music && music.paused) {
    music.play().catch(() => {});
  }
}, { once: true });

window.addEventListener("load", () => {
  document.getElementById("codeInput").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      checkCode();
    }
  });
  actualizarProgreso();
});

function mostrarImagenModal(src) {
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImg");
  modal.style.display = "block";
  modalImg.src = src;
}

function cerrarModal() {
  document.getElementById("imageModal").style.display = "none";
}

document.addEventListener("visibilitychange", () => {
  const bgMusic = document.getElementById("bgMusic");
  const codeAudio = document.getElementById("codeAudio");

  if (document.visibilityState === "visible") {
    if (bgMusic && bgMusic.paused && codeAudio.paused) {
      bgMusic.play().catch(() => {});
    }
  }
});
